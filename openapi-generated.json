{
  "openapi": "3.0.0",
  "info": {
    "title": "FHIRHub API",
    "version": "3.0.0",
    "description": "API complète de conversion HL7 v2 → FHIR R4 avec conformité FR-Core pour systèmes de santé français",
    "contact": {
      "name": "FHIRHub Support",
      "email": "support@fhirhub.fr"
    }
  },
  "servers": [
    {
      "url": "http://localhost:5000",
      "description": "Serveur de développement"
    }
  ],
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "Clé API pour authentification"
      },
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "HL7Message": {
        "type": "object",
        "required": [
          "hl7Message"
        ],
        "properties": {
          "hl7Message": {
            "type": "string",
            "description": "Message HL7 v2.5 au format texte"
          },
          "encoding": {
            "type": "string",
            "default": "utf-8",
            "description": "Encodage du message"
          },
          "applicationId": {
            "type": "integer",
            "description": "ID de l'application source"
          }
        }
      },
      "FHIRBundle": {
        "type": "object",
        "properties": {
          "resourceType": {
            "type": "string",
            "example": "Bundle"
          },
          "id": {
            "type": "string"
          },
          "meta": {
            "type": "object",
            "properties": {
              "profile": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "type": {
            "type": "string",
            "example": "message"
          },
          "entry": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "fullUrl": {
                  "type": "string"
                },
                "resource": {
                  "type": "object"
                },
                "request": {
                  "type": "object",
                  "properties": {
                    "method": {
                      "type": "string"
                    },
                    "url": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "ConversionResult": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "bundle": {
            "$ref": "#/components/schemas/FHIRBundle"
          },
          "processing_time": {
            "type": "number"
          },
          "resource_count": {
            "type": "integer"
          },
          "message_type": {
            "type": "string"
          },
          "fr_core_compliant": {
            "type": "boolean"
          }
        }
      },
      "ValidationResult": {
        "type": "object",
        "properties": {
          "valid": {
            "type": "boolean"
          },
          "errors": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "warnings": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "fr_core_conformance": {
            "type": "boolean"
          }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "username": {
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "admin",
              "user"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "last_login": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ApiKey": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "name": {
            "type": "string"
          },
          "key_hash": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "last_used": {
            "type": "string",
            "format": "date-time"
          },
          "usage_count": {
            "type": "integer"
          },
          "is_active": {
            "type": "boolean"
          }
        }
      },
      "Application": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "conversion_count": {
            "type": "integer"
          }
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "error": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "details": {
            "type": "object"
          }
        }
      }
    },
    "responses": {
      "BadRequest": {
        "description": "Requête invalide",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            }
          }
        }
      },
      "Unauthorized": {
        "description": "Non autorisé",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            }
          }
        }
      },
      "NotFound": {
        "description": "Ressource non trouvée",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            }
          }
        }
      },
      "InternalError": {
        "description": "Erreur serveur interne",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            }
          }
        }
      }
    }
  },
  "paths": {
    "/api/convert": {
      "post": {
        "tags": [
          "Conversion"
        ],
        "summary": "Convertir message HL7 v2 en FHIR R4",
        "description": "Conversion complète avec conformité FR-Core automatique",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/HL7Message"
              },
              "example": {
                "hl7Message": "MSH|^~\\&|MCK|1.2.250.1.211.10.200.1^ISO|ASIP-SANTE|1.2.250.1.213.1.4.8^ISO|20241220084502||ADT^A04^ADT_A01|20241220084502|P|2.5|||NE|NE|FR^France^ISO3166_1||8859/1\nPID|1||835726^^^MCK&1.2.250.1.211.10.200.1&ISO^PI||MARTIN^PIERRE^JEAN||19701201|M",
                "encoding": "utf-8"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Conversion réussie",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversionResult"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "500": {
            "$ref": "#/components/responses/InternalError"
          }
        }
      }
    },
    "/api/convert/validate": {
      "post": {
        "tags": [
          "Validation"
        ],
        "summary": "Valider Bundle FHIR contre profils FR-Core",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FHIRBundle"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validation terminée",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationResult"
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "Connexion utilisateur",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "username",
                  "password"
                ],
                "properties": {
                  "username": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Connexion réussie",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "token": {
                      "type": "string"
                    },
                    "user": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Liste des utilisateurs",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Liste récupérée",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/User"
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Users"
        ],
        "summary": "Créer utilisateur",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "username",
                  "email",
                  "password"
                ],
                "properties": {
                  "username": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  },
                  "role": {
                    "type": "string",
                    "enum": [
                      "admin",
                      "user"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Utilisateur créé",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          }
        }
      }
    },
    "/api/api-keys": {
      "get": {
        "tags": [
          "API Keys"
        ],
        "summary": "Liste des clés API",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Clés récupérées",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ApiKey"
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "API Keys"
        ],
        "summary": "Créer clé API",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Clé créée",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiKey"
                }
              }
            }
          }
        }
      }
    },
    "/api/applications": {
      "get": {
        "tags": [
          "Applications"
        ],
        "summary": "Liste des applications",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Applications récupérées",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Application"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/system/health": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "État de santé du système",
        "responses": {
          "200": {
            "description": "Système opérationnel",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "healthy"
                    },
                    "uptime": {
                      "type": "number"
                    },
                    "memory": {
                      "type": "object"
                    },
                    "database": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/system/version": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "Version de l'application",
        "responses": {
          "200": {
            "description": "Informations version",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "version": {
                      "type": "string"
                    },
                    "build": {
                      "type": "string"
                    },
                    "environment": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/stats": {
      "get": {
        "tags": [
          "Statistics"
        ],
        "summary": "Statistiques générales",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Statistiques récupérées",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "conversions": {
                      "type": "integer"
                    },
                    "uptime": {
                      "type": "number"
                    },
                    "memory": {
                      "type": "object"
                    },
                    "conversionStats": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/fhir/servers": {
      "get": {
        "tags": [
          "FHIR"
        ],
        "summary": "Liste des serveurs FHIR",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Serveurs FHIR récupérés"
          }
        }
      }
    },
    "/api/ai/analyze-patient": {
      "post": {
        "tags": [
          "AI"
        ],
        "summary": "Analyse IA d'un patient FHIR",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "patient": {
                    "type": "object"
                  },
                  "context": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Analyse terminée"
          }
        }
      }
    },
    "/api/terminology/french": {
      "get": {
        "tags": [
          "Terminology"
        ],
        "summary": "Terminologies françaises (ANS/MOS)",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Informations terminologies"
          }
        }
      }
    },
    "/api/cache/clear": {
      "post": {
        "tags": [
          "Cache"
        ],
        "summary": "Vider le cache",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Cache vidé"
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Conversion",
      "description": "Endpoints de conversion HL7 → FHIR"
    },
    {
      "name": "Validation",
      "description": "Validation FR-Core et FHIR"
    },
    {
      "name": "Users",
      "description": "Gestion des utilisateurs"
    },
    {
      "name": "API Keys",
      "description": "Gestion des clés API"
    },
    {
      "name": "Applications",
      "description": "Gestion des applications"
    },
    {
      "name": "Authentication",
      "description": "Authentification et autorisation"
    },
    {
      "name": "System",
      "description": "Informations système et santé"
    },
    {
      "name": "Statistics",
      "description": "Statistiques et métriques"
    },
    {
      "name": "FHIR",
      "description": "Intégration serveurs FHIR"
    },
    {
      "name": "AI",
      "description": "Intelligence artificielle et analyse"
    },
    {
      "name": "Terminology",
      "description": "Terminologies françaises (ANS/MOS)"
    },
    {
      "name": "Cache",
      "description": "Gestion du cache"
    },
    {
      "name": "Admin",
      "description": "Administration système"
    }
  ]
}